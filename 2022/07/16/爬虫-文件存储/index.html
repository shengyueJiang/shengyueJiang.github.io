<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>爬虫-数据存储 | ShengyueJiang's Blog</title><meta name="keywords" content="数据存储"><meta name="author" content="ShengyueJiang"><meta name="copyright" content="ShengyueJiang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文件存储TXT文件存储检索和结构信息不够方便，但是能够兼容很多平台，对于结构要求不高可以使用。 1234file &#x3D; open(&amp;#x27;teacher.txt&amp;#x27;, &amp;#x27;a&amp;#x27;, encoding&#x3D;&amp;#x27;utf-8&amp;#x27;)for key in name_url_dic.keys():    file.write(&amp;#x27;\n&amp;#x27;.join([ke">
<meta property="og:type" content="article">
<meta property="og:title" content="爬虫-数据存储">
<meta property="og:url" content="http://sehngyuejiang.live/2022/07/16/%E7%88%AC%E8%99%AB-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/index.html">
<meta property="og:site_name" content="ShengyueJiang&#39;s Blog">
<meta property="og:description" content="文件存储TXT文件存储检索和结构信息不够方便，但是能够兼容很多平台，对于结构要求不高可以使用。 1234file &#x3D; open(&amp;#x27;teacher.txt&amp;#x27;, &amp;#x27;a&amp;#x27;, encoding&#x3D;&amp;#x27;utf-8&amp;#x27;)for key in name_url_dic.keys():    file.write(&amp;#x27;\n&amp;#x27;.join([ke">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&refer=http%3A%2F%2Fimg.sccnn.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1659841150&t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&refer=http%3A%2F%2Fimg.sccnn.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1659841150&t=a45193f205277d83824df756e15de1a7">
<meta property="article:published_time" content="2022-07-16T07:34:49.000Z">
<meta property="article:modified_time" content="2022-08-07T09:30:11.227Z">
<meta property="article:author" content="ShengyueJiang">
<meta property="article:tag" content="数据存储">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&refer=http%3A%2F%2Fimg.sccnn.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1659841150&t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&refer=http%3A%2F%2Fimg.sccnn.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1659841150&t=a45193f205277d83824df756e15de1a7"><link rel="shortcut icon" href="https://sm.ms/delete/E13tcHWf5FBqyXGSpkLA4ejNu2"><link rel="canonical" href="http://sehngyuejiang.live/2022/07/16/%E7%88%AC%E8%99%AB-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: ShengyueJiang","link":"Link: ","source":"Source: ShengyueJiang's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '爬虫-数据存储',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-07 17:30:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://sm.ms/delete/E13tcHWf5FBqyXGSpkLA4ejNu2" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">12</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Social Contact</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> messageboard</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></li><li><a class="site-page child" href="/Talks/"><i class="fa-fw fa fa-commenting"></i><span> Talks</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ShengyueJiang's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Social Contact</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> messageboard</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></li><li><a class="site-page child" href="/Talks/"><i class="fa-fw fa fa-commenting"></i><span> Talks</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">爬虫-数据存储</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-07-16T07:34:49.000Z" title="Created 2022-07-16 15:34:49">2022-07-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-08-07T09:30:11.227Z" title="Updated 2022-08-07 17:30:11">2022-08-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="爬虫-数据存储"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="文件存储"><a href="#文件存储" class="headerlink" title="文件存储"></a>文件存储</h1><h2 id="TXT文件存储"><a href="#TXT文件存储" class="headerlink" title="TXT文件存储"></a>TXT文件存储</h2><p>检索和结构信息不够方便，但是能够兼容很多平台，对于结构要求不高可以使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;teacher.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> name_url_dic.keys():</span><br><span class="line">    file.write(<span class="string">&#x27;\n&#x27;</span>.join([key, name_url_dic[key]]))</span><br><span class="line">    file.write(<span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27;=&#x27;</span> * <span class="number">50</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>使用<strong>open（）</strong>方法打开一个文本文件，获取一个文件操作对象，赋值为file，接着使用<strong>write（）</strong>方法提取的内容写入文件，最后调用<strong>close（）</strong>方法将其关闭。</p>
<p>其中第一个参数为文件名称，第二个参数为处理文本的方式，最后指定编码方式。最后还要关闭文件对象。</p>
<p>文件的打开方式有很多种：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>以<strong>只读方式</strong>打开文件，文件的指针在<strong>文件的开头</strong>。</td>
</tr>
<tr>
<td>rb</td>
<td>以<strong>二进制的只读</strong>方式打开文件，文件的指针在<strong>文件的开头</strong>。</td>
</tr>
<tr>
<td>r+</td>
<td>以<strong>读写方式</strong>打开一个文件，文件的指针在<strong>文件的开头</strong>。</td>
</tr>
<tr>
<td>rb+</td>
<td>以<strong>二进制读写</strong>方式打开一个文件，文件的指针在<strong>文件的开头</strong>。</td>
</tr>
<tr>
<td>w</td>
<td>以<strong>写入方式</strong>打开文件，如果文件已经存在，将其覆盖，不存在则新建一个文件。</td>
</tr>
<tr>
<td>wb</td>
<td>以<strong>二进制写入</strong>方式打开一个文件，如果文件已经存在，将其覆盖，不存在则新建一个文件。</td>
</tr>
<tr>
<td>w+</td>
<td>以<strong>读写方式</strong>打开一个文件，如果文件已经存在，将其覆盖，不存在则新建一个文件。</td>
</tr>
<tr>
<td>wb+</td>
<td>以<strong>二进制读写</strong>方式打开一个文件，如果文件已经存在，将其覆盖，不存在则新建一个文件。</td>
</tr>
<tr>
<td>a</td>
<td>以<strong>追加</strong>的方式打开一个文件，如果文件已经存在将其写入到文件后边，<strong>指针在文件尾部</strong>，不存在则新建一个文件。</td>
</tr>
<tr>
<td>ab</td>
<td>以<strong>二进制追加</strong>的方式打开一个文件，如果文件已经存在将其写入到文件后边，<strong>指针在文件尾部</strong>，不存在则新建一个文件。</td>
</tr>
<tr>
<td>a+</td>
<td>以<strong>读写方式</strong>打开一个文件，如果文件已经存在，文件<strong>指针会在文件的尾部</strong>，打开时为追加模式，如果文件不存在则创建新文件。</td>
</tr>
<tr>
<td>ab+</td>
<td>以<strong>二进制追加方式</strong>打开一个文件，如果文件已经存在，则文件指针将会放在文件尾部。</td>
</tr>
</tbody>
</table>
</div>
<p>除上述方法外，还有简单的方法书写代码，使用with as语法。在with控制块结束时，文件自动关闭。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;teacher.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">&#x27;\n&#x27;</span>.join([key, name_url_dic[key]]))</span><br></pre></td></tr></table></figure>
<h2 id="JSON文件储存"><a href="#JSON文件储存" class="headerlink" title="JSON文件储存"></a>JSON文件储存</h2><p><strong>JSON</strong>,全称为<strong>JavaScript Object Notation</strong>,表示JavaScript对象标记，它通过对象和数组的组合来表示数据，构造简洁但是结构化程度很高，是一种轻量级的数据交换格式。</p>
<p>可以调用<strong>JSON</strong>库中的l<strong>loads（）</strong>方法将JSON文字字符串转换为JSON对象，可以通过<strong>dumps（）</strong>方法将JSON对象转换为文字字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">string = <span class="string">&#x27;&#x27;&#x27;[&#123;</span></span><br><span class="line"><span class="string">    &quot;name&quot;:&quot;jack&quot;,</span></span><br><span class="line"><span class="string">    &quot;gender&quot;:&quot;male&quot;</span></span><br><span class="line"><span class="string">&#125;,&#123;</span></span><br><span class="line"><span class="string">    &quot;name&quot;:&quot;jack&quot;,</span></span><br><span class="line"><span class="string">    &quot;gender&quot;:&quot;male&quot;</span></span><br><span class="line"><span class="string">&#125;]&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 将字符串转换为json格式</span></span><br><span class="line">data = json.loads(string)</span><br><span class="line"><span class="comment"># 根据键值获取某值</span></span><br><span class="line">data[<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="comment"># 使用get方法来获取值</span></span><br><span class="line">data[<span class="number">0</span>].get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">data[<span class="number">0</span>].get(<span class="string">&#x27;age&#x27;</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>转换字符串为<strong>json</strong>格式后，既可以通过键值或者<strong>get（）</strong>来获取值，其第二个参数表示当第一个参数指定的内容不存在时将会返回的内容。</p>
<p>除上述方法外，还可以使用<strong>dump（）</strong>把<strong>json</strong>格式转换为字符串，然后再调用文件的<strong>write（）</strong>方法来保存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">	file.wtrite(json.dumps(data, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<p>其中第二个参数表示保存后的缩进，最后一个参数控制中文不会乱码。</p>
<h2 id="csv文件存储"><a href="#csv文件存储" class="headerlink" title="csv文件存储"></a>csv文件存储</h2><p>将文件储存为CSV格式也需要首先打开文件，然后指定打开的方式，随后初始化<strong>writer（）</strong>的方法初始化写入对象，传入该句柄，然后调用<strong>writerow（）</strong>方法传入每行的数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;teacher.csv&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.writer(file)</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> name_url_dic.keys():</span><br><span class="line">            writer.writerow([key, name_url_dic[key]])</span><br></pre></td></tr></table></figure>
<p>可以修改delimiter参数来修改分隔符号，也可以调用<strong>writerows（）</strong>方法写入多行，此时参数需要为二维列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;teacher.csv&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.writer(file, delimiter=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        writer.writerows([[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>],[<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;tom&#x27;</span>],[<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;tim&#x27;</span>]])</span><br></pre></td></tr></table></figure>
<p>可以初始化一个对象来针对字典对象进行存储，接着调用<strong>writeheader（）</strong>方法写入头信息，然后调用<strong>writerow（）</strong>此时传入的参数为一个数组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fieldnames = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;teacher.csv&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.DictWriter(file, delimiter=<span class="string">&#x27; &#x27;</span>, fieldnames=fieldnames)</span><br><span class="line">        writer.writeheader()</span><br><span class="line">        writer.writerows(&#123;<span class="string">&#x27;id&#x27;</span>:<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jack&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>读取CSV文件也可以使用csv库。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;teacher.csv&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    reader = csv.reader(file)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        	<span class="built_in">print</span>(row)</span><br></pre></td></tr></table></figure>
<h1 id="MySQL存储"><a href="#MySQL存储" class="headerlink" title="MySQL存储"></a>MySQL存储</h1><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>首先需要通过库中的<strong>connect（）</strong>方法声明一个连接对象<strong>db</strong>，此时需要传入<strong>MySQL</strong>的<strong>host</strong>（即IP）。由于<strong>MySQL</strong>在本地运行，许哦一传入的是<strong>localhost</strong>。如果<strong>MySQL</strong>在远程运行，则传入公网<strong>IP</strong>地址。后续的参数<strong>user</strong>即为用户名，<strong>password</strong>即密码，<strong>post</strong>即端口（默认为3306）。最后创建一个数据库用于后部分操作，默认编码格式为<strong>UTF-8</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#声明数据库连接对象</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;******&#x27;</span>, port=<span class="number">3306</span>)</span><br><span class="line"><span class="comment">#获得操作游标</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"><span class="comment">#execute执行语句</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;SELECT VERSION()&#x27;</span>)</span><br><span class="line"><span class="comment">#获取第一条数据</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"><span class="comment">#创建数据库</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;CREATE DATABASE databasename DEFAULT CHARACTER SET utf8&#x27;</span>)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>首先连接数据库的部分，需要增加额外的参数确定使用的数据库，这里使用的是上边创建的数据库。实际使用爬虫的时候，创建的表是由实际情况而定的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#连接数据库</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;******&#x27;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;soiders&#x27;</span>)</span><br><span class="line"><span class="comment">#编写sql语句</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;CREATE TABLE IF NOT EXISTS students </span></span><br><span class="line"><span class="string">(id VARCHAR(255) NOT NULL, </span></span><br><span class="line"><span class="string">  name VARCHAR(255) NOT NULL, </span></span><br><span class="line"><span class="string">  age INT NOT NULL, </span></span><br><span class="line"><span class="string">  PRIMARY KEY (id))&#x27;&#x27;&#x27;</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><p>构造一个数据字典可以有效地防止数据库中的表格发生变化的情况，根据其情况构造动态语句，最后加入异常处理保证数据的原子性。另外对于插入，更新，删除等操作都需要调用<strong>commit</strong>方法才可以实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#构造数据字典</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> : <span class="string">&#x27;20120002&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> : <span class="string">&#x27;tom&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;age&#x27;</span> : <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#连接数据库获得执行游标</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;200062&#x27;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;soiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;students&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;,&#x27;</span>.join(data.keys())</span><br><span class="line">values = <span class="string">&#x27;,&#x27;</span>.join([<span class="string">&#x27;%s&#x27;</span>] * <span class="built_in">len</span>(data.values()))</span><br><span class="line"><span class="comment">#构造动态执行语句</span></span><br><span class="line">sql = <span class="string">f&#x27;INSERT INTO <span class="subst">&#123;table&#125;</span>(<span class="subst">&#123;key&#125;</span>) values(<span class="subst">&#123;values&#125;</span>)&#x27;</span></span><br><span class="line"><span class="comment">#加入异常处理，如果语句执行失败则进行数据回滚</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql, <span class="built_in">tuple</span>(data.values())):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;okay&#x27;</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;no&#x27;</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><p>数据更新实际上也是执行SQL语句，可以直接构造语句进行更新，但是这种方式不是最好的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">&#x27;UPDATE students SET age = %s WHERE name = %s&#x27;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql,(<span class="number">25</span>, <span class="string">&#x27;Bob&#x27;</span>))</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure>
<p>实际使用爬虫连接数据库的时候，我们通常不希望重复数据的出现。所以本部分采用动态构造语句，如果主键存在则会更新语句，如果不存在则会新增一条数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更新数据</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> : <span class="string">&#x27;20120005&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> : <span class="string">&#x27;COCO&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;age&#x27;</span> : <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;******&#x27;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;databasename&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">table = <span class="string">&#x27;students&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;,&#x27;</span>.join(data.keys())</span><br><span class="line">values = <span class="string">&#x27;,&#x27;</span>.join([<span class="string">&#x27;%s&#x27;</span>] * <span class="built_in">len</span>(data))</span><br><span class="line"><span class="comment">#动态构造sql语句</span></span><br><span class="line">sql = <span class="string">f&#x27;INSERT INTO <span class="subst">&#123;table&#125;</span>(<span class="subst">&#123;key&#125;</span>) values(<span class="subst">&#123;values&#125;</span>) ON DUPLICATE KEY UPDATE &#x27;</span></span><br><span class="line">update = <span class="string">&#x27;,&#x27;</span>.join([<span class="string">&#x27;&#123;key&#125; = %s&#x27;</span>.<span class="built_in">format</span>(key = key) <span class="keyword">for</span> key <span class="keyword">in</span> data])</span><br><span class="line">sql += update</span><br><span class="line"><span class="comment">#执行语句</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql, <span class="built_in">tuple</span>(data.values())*<span class="number">2</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;okay&#x27;</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;no&#x27;</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">    </span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>直接使用<strong>DELETE</strong>语句就可以删除，但是需要指定目标表明和删除条件，而且需要相应的<strong>commit（）</strong>方法才能生效。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;******&#x27;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;soiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"><span class="comment">#查询条件和查询表名</span></span><br><span class="line"><span class="comment">#此处的条件需要嵌套引号</span></span><br><span class="line">table = <span class="string">&#x27;students&#x27;</span></span><br><span class="line">condititon = <span class="string">&quot;name=&#x27;COCO&#x27;&quot;</span></span><br><span class="line"><span class="comment">#动态查询条件语句</span></span><br><span class="line">sql = <span class="string">f&#x27;DELETE FROM <span class="subst">&#123;table&#125;</span> WHERE <span class="subst">&#123;condititon&#125;</span>&#x27;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    db.commit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    db.rollback()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;NO&#x27;</span>)</span><br><span class="line"></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>查询数据可以直接构建查询SQL语句，在此处不需要使用commit方法就可以完成查询操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;******&#x27;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;soiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">&#x27;SELECT * FROM students WHERE age&gt;=20&#x27;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment">#此处调用的方法只能获取结果的第一行</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;count:&#x27;</span>, cursor.rowcount)</span><br><span class="line">    one = cursor.fetchone()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;one:&#x27;</span>, one)</span><br><span class="line">    <span class="comment">#此处调用的方法获取结果的所有行</span></span><br><span class="line">    result = cursor.fetchall()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Result&#x27;</span>, result)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> result:</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>这里需要注意的问题是，其内部实现有一个偏移指针，当我们首先调用了<strong>fetchone</strong>的时候，指针已经向后移位，所以再调用<strong>fetchall</strong>的时候会查询到后面的全部内容。使用<strong>while</strong>语句可以很好的解决上述问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;200062&#x27;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;soiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">&#x27;SELECT * FROM students WHERE age&gt;=20&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;count:&#x27;</span>, cursor.rowcount)</span><br><span class="line">    row = cursor.fetchone()</span><br><span class="line">    <span class="comment">#使用while构建查询语句</span></span><br><span class="line">    <span class="keyword">while</span> row:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Row:&#x27;</span>, row)</span><br><span class="line">        row = cursor.fetchone()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="MongoDB存储"><a href="#MongoDB存储" class="headerlink" title="MongoDB存储"></a>MongoDB存储</h1><h2 id="连接数据库-1"><a href="#连接数据库-1" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>连接数据之前首先要启动数据库，除此之外还需要很多配置。配置后既可以连接数据库：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="comment">#连接数据库，指定接口，默认为27017</span></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">27017</span>)</span><br><span class="line"><span class="comment"># client = pymongo.MongoClient(&#x27;mongodb://localhost:27017/&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定数据库</span></span><br><span class="line">db = client.test</span><br><span class="line"><span class="comment"># db = client[&#x27;test&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定集合，类似于关系数据库中的表</span></span><br><span class="line">collection = db.students</span><br><span class="line"><span class="comment"># collection = db[&#x27;students&#x27;]</span></span><br></pre></td></tr></table></figure>
<h2 id="插入数据-1"><a href="#插入数据-1" class="headerlink" title="插入数据"></a>插入数据</h2><p>MongoDB会自动创建一个标识符ID用来作为唯一的标识，插入有两种官方推荐的方式，分别可以插入一条和多条语句。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">student = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>:<span class="string">&#x27;2017131108&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jordan&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>:<span class="number">20</span>,</span><br><span class="line">    <span class="string">&#x27;gender&#x27;</span>:<span class="string">&#x27;male&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">result = collection.insert_one(student)</span><br><span class="line"><span class="comment">#result = collection.insert_one([student1, student2])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以返回该条语句的id</span></span><br><span class="line"><span class="built_in">print</span>(result.inserted_id)</span><br></pre></td></tr></table></figure>
<p>返回的是一个对象，调用其属性可以返回id的值。</p>
<h2 id="查询数据-1"><a href="#查询数据-1" class="headerlink" title="查询数据"></a>查询数据</h2><p>利用find_one（）方法查询返回的是单个结果，find（）返回的是一个生成器对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据name为条件查询一个值</span></span><br><span class="line">result = collection.find_one(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jordan&#x27;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#返回了一个生成器对象</span></span><br><span class="line">result = collection.find(&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">20</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> re <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br></pre></td></tr></table></figure>
<p>也可以传入一个条件来进行查询，使用比较符号可以进行条件查询，常用的比较符号如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>$lt</td>
<td>小于</td>
<td>{‘age’:{‘$lt’:18}}</td>
</tr>
<tr>
<td>$gt</td>
<td>大于</td>
<td>{‘age’:{‘$gt’:18}}</td>
</tr>
<tr>
<td>$lte</td>
<td>小于等于</td>
<td>{‘age’:{‘$lte’:18}}</td>
</tr>
<tr>
<td>$gte</td>
<td>大于等于</td>
<td>{‘age’:{‘$gte’:18}}</td>
</tr>
<tr>
<td>$in</td>
<td>在范围内</td>
<td>{‘age’:{‘$in’:[18, 22]}}</td>
</tr>
<tr>
<td>$nin</td>
<td>不在范围内</td>
<td>{‘age’:{‘$nin’:[18, 22]}}</td>
</tr>
<tr>
<td>$ne</td>
<td>不等于</td>
<td>{‘age’:{‘$ne’:18}}</td>
</tr>
</tbody>
</table>
</div>
<p>传入条件语句即可进行查询：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = collection.find(&#123;<span class="string">&#x27;age&#x27;</span>:&#123;<span class="string">&#x27;$gt&#x27;</span>:<span class="number">18</span>&#125;&#125;)</span><br><span class="line"><span class="keyword">for</span> re <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br></pre></td></tr></table></figure>
<p>除此之外可以使用其它功能符号进行查询：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
<th>示例</th>
<th>示例含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>$regex</td>
<td>匹配正则表达式</td>
<td>{‘name’:{‘$regex’:’^j.*’}}</td>
<td>name以M开头</td>
</tr>
<tr>
<td>$exists</td>
<td>属性是否存在</td>
<td>{‘name’:{‘$exists’:True}}</td>
<td>name属性存在</td>
</tr>
<tr>
<td>$type</td>
<td>类型判断</td>
<td>{‘age’：{‘$type’：’int’}}</td>
<td>age的类型为int</td>
</tr>
<tr>
<td>$mod</td>
<td>数字模操作</td>
<td>{‘age’：{‘$mod’：[5, 0]}}</td>
<td>年龄模5余0</td>
</tr>
<tr>
<td>$text</td>
<td>文本查询</td>
<td>{‘$text’：{‘$search’：’Mike’}}</td>
<td>text类型的属性中包含Mike字符串</td>
</tr>
<tr>
<td>$where</td>
<td>高级条件查询</td>
<td>{‘$where’:’obj.fans_count == obj.follows_count’}</td>
<td>自身粉丝数等于关注数目</td>
</tr>
</tbody>
</table>
</div>
<p>下文显示了实际使用条件查询的示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = collection.find(&#123;<span class="string">&#x27;name&#x27;</span>:&#123;<span class="string">&#x27;$regex&#x27;</span>:<span class="string">&#x27;^j.*&#x27;</span>&#125;&#125;)</span><br><span class="line"><span class="keyword">for</span> re <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br></pre></td></tr></table></figure>
<h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><p>统计查询结果有多少条数据，可以调用。可以统计所有数据条数或者满足某条件的条数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#统计所有数据总条数</span></span><br><span class="line">count = collection.find().count()</span><br><span class="line"><span class="built_in">print</span>(count)</span><br><span class="line"><span class="comment">#统计满足条件的数据个数</span></span><br><span class="line">count = collection.count_documents(&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">20</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(count)</span><br></pre></td></tr></table></figure>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>排序时，直接调用sort（）方法，并在其中传入排序的字段以及升降序标志即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pymongo.ASCENDING表示升序</span></span><br><span class="line"><span class="comment">#pymongo.DESCENDING表示降序</span></span><br><span class="line">results = collection.find().sort(<span class="string">&#x27;name&#x27;</span>, pymongo.ASCENDING)</span><br><span class="line"><span class="built_in">print</span>([result[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre></td></tr></table></figure>
<h2 id="偏移"><a href="#偏移" class="headerlink" title="偏移"></a>偏移</h2><p>在某些情况下我们只需要其中的几个元素，或者限制指定要取的个数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#.skip(1)向后偏移一个元素</span></span><br><span class="line"><span class="comment">#.limit(2)限制取出来的元素在两个</span></span><br><span class="line">results = collection.find().sort(<span class="string">&#x27;name&#x27;</span>, pymongo.ASCENDING).skip(<span class="number">1</span>).limit(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>([result[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre></td></tr></table></figure>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>更新数据首先需要查询出来，然后修改字典，最后第一个参数传入查询的条件，第二个参数传入修改后的数据。最后可以调用属性显示匹配数据条数以及影响的数据条数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">condition = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;Kevin&#x27;</span>&#125; </span><br><span class="line">student = collection.find_one(condition) </span><br><span class="line">student [<span class="string">&#x27;age&#x27;</span>] = <span class="number">26</span> </span><br><span class="line">result = collection.update_one(condition, &#123;<span class="string">&#x27;$set&#x27;</span>: student&#125;) </span><br><span class="line"><span class="built_in">print</span>(result) </span><br><span class="line"><span class="comment">#调用属性显示匹配数据条数和影响的数据条数</span></span><br><span class="line"><span class="built_in">print</span>(result.matched_count, result.modified_count)</span><br></pre></td></tr></table></figure>
<p>如果调用update_many则可以更新很多条目。</p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>使用两种方法可以分别删除一条和多条数据，其中参数为删除条件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除一条数据</span></span><br><span class="line">result = collection.delete_one(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jordan&#x27;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(result.deleted_count)</span><br><span class="line"><span class="comment">#删除多条数据</span></span><br><span class="line">result = collection.delete_many(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jordan&#x27;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result.deleted_count)</span><br></pre></td></tr></table></figure>
<h1 id="Redis存储"><a href="#Redis存储" class="headerlink" title="Redis存储"></a>Redis存储</h1><h2 id="连接Redis"><a href="#连接Redis" class="headerlink" title="连接Redis"></a>连接Redis</h2><p>连接Redis有三种方式,可以直接传入地址，运行端口，使用的数据库和密码信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis,ConnectionPool</span><br><span class="line"><span class="comment">#直接传入主机地址端口和密码</span></span><br><span class="line">redis = StrictRedis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>,password=<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line"><span class="comment">#构建ConnectionPool来进行连接</span></span><br><span class="line">pool = ConnectionPool(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>,password=<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line">redis = StricRedis(connection_pool = pool)</span><br><span class="line"><span class="comment">#使用URL来建立连接</span></span><br><span class="line">url = <span class="string">&#x27;redis://:foobared@localhost:6379/0 ’ </span></span><br><span class="line"><span class="string">pool = ConnectionPool. ram url(url) </span></span><br><span class="line"><span class="string">redis = StrictRedis(connection_pool=pool) </span></span><br></pre></td></tr></table></figure>
<h2 id="键操作"><a href="#键操作" class="headerlink" title="键操作"></a>键操作</h2><p>下表中给出了所有主流的键操作。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>参数表示</th>
<th>示例</th>
<th>示例说明</th>
<th>示例结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>exists(name)</td>
<td>判断一个键是否存在</td>
<td>name:键名</td>
<td>redis.exists(‘name’)</td>
<td>是否存在name这个键</td>
<td>True</td>
</tr>
<tr>
<td>delete(name)</td>
<td>删除一个键</td>
<td>name:键名</td>
<td>redis.delete(‘name’)</td>
<td>删除name这个键</td>
<td>1</td>
</tr>
<tr>
<td>type(name)</td>
<td>判断键类型</td>
<td>name:键名</td>
<td>redis.type(‘name’)</td>
<td>判断name这个键值类型</td>
<td>‘string’</td>
</tr>
<tr>
<td>keys(pattern)</td>
<td>获取所有符合规则的键</td>
<td>pattern：匹配规则</td>
<td>redis.keys(‘n*’)</td>
<td>获取所有以n为开头的键</td>
<td>[b’name’]</td>
</tr>
<tr>
<td>randomkey()</td>
<td>获取随机的一个键</td>
<td>无</td>
<td>randomkey()</td>
<td>获取随机的一个键值</td>
<td>b’name’</td>
</tr>
<tr>
<td>rename(src,dst)</td>
<td>重命名键</td>
<td>src：原键名；dst：新键名</td>
<td>redis.rename(‘name’, ‘nickname’)</td>
<td>将name重命名为nickname</td>
<td>True</td>
</tr>
<tr>
<td>dbsize()</td>
<td>获取当前数据库中键得数目</td>
<td>无</td>
<td>dbsize()</td>
<td>获取当前数据库中键得数目</td>
<td>100</td>
</tr>
<tr>
<td>expire(name, time)</td>
<td>设定键得过期时间，单位为秒</td>
<td>name:键名；time：秒数</td>
<td>redis.expire(‘name’, 2)</td>
<td>将name键得过期时间设置为2秒</td>
<td>True</td>
</tr>
<tr>
<td>ttle(name)</td>
<td>获取键得过期时间，单位为秒，-1为不过期</td>
<td>name:键名</td>
<td>resis.ttl(‘name’)</td>
<td>获取name这个键得过期时间</td>
<td>-1</td>
</tr>
<tr>
<td>move(name, db)</td>
<td>将键移动到其他数据库</td>
<td>name:键名；db：数据库代号</td>
<td>move(‘name’, 2)</td>
<td>将name移动到2号数据库</td>
<td>True</td>
</tr>
<tr>
<td>flushdb()</td>
<td>删除当前选择数据库中的所有键</td>
<td></td>
<td>flushdb()</td>
<td>删除当前选择数据库中的所有键</td>
<td>True</td>
</tr>
<tr>
<td>flushall()</td>
<td>删除所有数据库中的所有键</td>
<td></td>
<td>flushall()</td>
<td>删除所有数据库中所有键</td>
<td>True</td>
</tr>
</tbody>
</table>
</div>
<h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>参数说明</th>
<th>示例</th>
<th>实例说明</th>
<th>示例结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>set(name, value)</td>
<td>给数据库中键为name中的string赋予值value</td>
<td>name:键名；value：值；</td>
<td>redis.set(‘name’, ‘Bob’)</td>
<td>给name这个键value赋为Bob</td>
<td>True</td>
</tr>
<tr>
<td>get(name)</td>
<td>返回数据库中键为name的string的value</td>
<td>name：键名</td>
<td>redis.get(‘name’)</td>
<td>返回name这个键的value</td>
<td>b’Bob’</td>
</tr>
<tr>
<td>getset(name)</td>
<td>返回数据库中键为name的string的value,并返回上次的value</td>
<td>name:键名；value：新值；</td>
<td>redis.getset(‘name’, ‘Bob’)</td>
<td>赋值name为Mike并得到上次的value</td>
<td>b’Bob’</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h2 id="列表操作"><a href="#列表操作" class="headerlink" title="列表操作"></a>列表操作</h2><h2 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h2><h2 id="有序集合操作"><a href="#有序集合操作" class="headerlink" title="有序集合操作"></a>有序集合操作</h2><h2 id="散列操作"><a href="#散列操作" class="headerlink" title="散列操作"></a>散列操作</h2><h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="CSV输出后有空行"><a href="#CSV输出后有空行" class="headerlink" title="CSV输出后有空行"></a>CSV输出后有空行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;vag.csv&#x27;</span>, mode = <span class="string">&#x27;w+&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        writer = csv.DictWriter(f, delimiter=<span class="string">&#x27;,&#x27;</span>, fieldnames=fieldnames)</span><br><span class="line">        writer.writeheader()</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> result[<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">            writer.writerow(v)</span><br></pre></td></tr></table></figure>
<p>在打开文件的部分设置参数，<strong>newline</strong>参数为空即可。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">ShengyueJiang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://sehngyuejiang.live/2022/07/16/%E7%88%AC%E8%99%AB-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/">http://sehngyuejiang.live/2022/07/16/%E7%88%AC%E8%99%AB-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/">数据存储</a></div><div class="post_share"><div class="social-share" data-image="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/20/%E7%88%AC%E8%99%AB-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%BC%82%E6%AD%A5%E6%90%BA%E7%A8%8B%E7%9A%84%E5%BA%94%E7%94%A8/"><img class="prev-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">爬虫-多线程与异步协程的应用</div></div></a></div><div class="next-post pull-right"><a href="/2022/07/14/%E7%88%AC%E8%99%AB-XPATH%E7%9A%84%E4%BD%BF%E7%94%A8/"><img class="next-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">爬虫-XPath的使用</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://sm.ms/delete/E13tcHWf5FBqyXGSpkLA4ejNu2" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ShengyueJiang</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">12</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="http://shengyuejiang.live/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/shengyuejiang@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">最近在学爬虫捏。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="toc-number">1.</span> <span class="toc-text">文件存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TXT%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="toc-number">1.1.</span> <span class="toc-text">TXT文件存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON%E6%96%87%E4%BB%B6%E5%82%A8%E5%AD%98"><span class="toc-number">1.2.</span> <span class="toc-text">JSON文件储存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csv%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="toc-number">1.3.</span> <span class="toc-text">csv文件存储</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%AD%98%E5%82%A8"><span class="toc-number">2.</span> <span class="toc-text">MySQL存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">2.2.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.</span> <span class="toc-text">插入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.</span> <span class="toc-text">更新数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">2.6.</span> <span class="toc-text">查询数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB%E5%AD%98%E5%82%A8"><span class="toc-number">3.</span> <span class="toc-text">MongoDB存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="toc-number">3.1.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE-1"><span class="toc-number">3.2.</span> <span class="toc-text">插入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-1"><span class="toc-number">3.3.</span> <span class="toc-text">查询数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">计数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">3.5.</span> <span class="toc-text">排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%8F%E7%A7%BB"><span class="toc-number">3.6.</span> <span class="toc-text">偏移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0"><span class="toc-number">3.7.</span> <span class="toc-text">更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">3.8.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%AD%98%E5%82%A8"><span class="toc-number">4.</span> <span class="toc-text">Redis存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5Redis"><span class="toc-number">4.1.</span> <span class="toc-text">连接Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">键操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">字符串操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.</span> <span class="toc-text">列表操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">4.5.</span> <span class="toc-text">集合操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">4.6.</span> <span class="toc-text">有序集合操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%A3%E5%88%97%E6%93%8D%E4%BD%9C"><span class="toc-number">4.7.</span> <span class="toc-text">散列操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CSV%E8%BE%93%E5%87%BA%E5%90%8E%E6%9C%89%E7%A9%BA%E8%A1%8C"><span class="toc-number">5.1.</span> <span class="toc-text">CSV输出后有空行</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/07/20/%E7%88%AC%E8%99%AB-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%BC%82%E6%AD%A5%E6%90%BA%E7%A8%8B%E7%9A%84%E5%BA%94%E7%94%A8/" title="爬虫-多线程与异步协程的应用"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="爬虫-多线程与异步协程的应用"/></a><div class="content"><a class="title" href="/2022/07/20/%E7%88%AC%E8%99%AB-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%BC%82%E6%AD%A5%E6%90%BA%E7%A8%8B%E7%9A%84%E5%BA%94%E7%94%A8/" title="爬虫-多线程与异步协程的应用">爬虫-多线程与异步协程的应用</a><time datetime="2022-07-20T01:57:39.000Z" title="Created 2022-07-20 09:57:39">2022-07-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/16/%E7%88%AC%E8%99%AB-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" title="爬虫-数据存储"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="爬虫-数据存储"/></a><div class="content"><a class="title" href="/2022/07/16/%E7%88%AC%E8%99%AB-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" title="爬虫-数据存储">爬虫-数据存储</a><time datetime="2022-07-16T07:34:49.000Z" title="Created 2022-07-16 15:34:49">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/14/%E7%88%AC%E8%99%AB-XPATH%E7%9A%84%E4%BD%BF%E7%94%A8/" title="爬虫-XPath的使用"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="爬虫-XPath的使用"/></a><div class="content"><a class="title" href="/2022/07/14/%E7%88%AC%E8%99%AB-XPATH%E7%9A%84%E4%BD%BF%E7%94%A8/" title="爬虫-XPath的使用">爬虫-XPath的使用</a><time datetime="2022-07-14T02:31:24.000Z" title="Created 2022-07-14 10:31:24">2022-07-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/11/%E7%88%AC%E8%99%AB-JavaScript%E9%80%86%E5%90%91%E8%BE%85%E5%8A%A9%E6%A8%A1%E6%8B%9F%E6%96%B9%E6%B3%95/" title="爬虫-JavaScript逆向辅助模拟方法"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="爬虫-JavaScript逆向辅助模拟方法"/></a><div class="content"><a class="title" href="/2022/07/11/%E7%88%AC%E8%99%AB-JavaScript%E9%80%86%E5%90%91%E8%BE%85%E5%8A%A9%E6%A8%A1%E6%8B%9F%E6%96%B9%E6%B3%95/" title="爬虫-JavaScript逆向辅助模拟方法">爬虫-JavaScript逆向辅助模拟方法</a><time datetime="2022-07-11T14:27:16.000Z" title="Created 2022-07-11 22:27:16">2022-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/11/%E7%88%AC%E8%99%AB-requests%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/" title="爬虫-requests库的使用"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="爬虫-requests库的使用"/></a><div class="content"><a class="title" href="/2022/07/11/%E7%88%AC%E8%99%AB-requests%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/" title="爬虫-requests库的使用">爬虫-requests库的使用</a><time datetime="2022-07-11T02:38:48.000Z" title="Created 2022-07-11 10:38:48">2022-07-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.sccnn.com%2Fbimg%2F321%2F118.jpg&amp;refer=http%3A%2F%2Fimg.sccnn.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1659841150&amp;t=a45193f205277d83824df756e15de1a7')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By ShengyueJiang</div><div class="footer_custom_text">记录生活，靠近自己</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'GJrh13JiTtanCWHn8gbpbgjt-gzGzoHsz',
      appKey: 'VFhEDzVfXjdMDlxm4NcfP7ps',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="true" data-text="Sloth,Anger,Lust,Gluttony,Pride,Avarice,Envy" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>